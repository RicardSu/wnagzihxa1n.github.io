<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>

<% getIndex("no-cache"); %>
<% jAspWebsGet("webs-header"); %>

<title>Diagnostics</title>

<script type="text/javascript" src="util_gw.js"></script>

<script language="javascript">
<% jAspIncludeLang("comm"); %>
<% jAspIncludeLang("code"); %>
<% jAspIncludeLang("syscmd"); %>

<% jAspWebsGet("webs-noclick"); %>

function saveClick()
{
	var hostObj = document.formSysCmd.sysHost;
	var cmd = document.formSysCmd.sysCmd.value;
	if (cmd == "ping" || cmd == "traceroute") {
		if(hostObj.value == ""){
			alert(mHost+mEmpty);
			hostObj.value = hostObj.defaultValue;
			hostObj.focus();
			return false ;
		}
	}

	return true;
}

function onCmdChange()
{
	if (document.getElementById("radio_ping").checked == true)
		document.getElementById("sysCmd").value = "ping";
	else if (document.getElementById("radio_tracert").checked == true)
		document.getElementById("sysCmd").value = "traceroute";
}

function getUrlParam(param)
{
	var url = window.location.href;
	var paraStr = url.substring(url.indexOf("?")+1, url.length);
	var paraArray = new Array();
	var retVal = "";

	if (typeof(paraStr) == "undefined" || paraStr.length == 0)
		return retVal;

	paraArray = paraStr.split("&");

	for (var i=0; i<paraArray.length; i++) {
		var item = paraArray[i];
		var name = item.substring(0, item.indexOf("="));
		var val = item.substring(item.indexOf("=")+1, item.length);
		if (typeof(name) == "undefined" || name != param)
			continue;

		if (typeof(val) != "undefined") {
			retVal = val;
		}
	}
	
	return retVal;
}

function init()
{
	show_div(false, "syscmd_div");

	var sysCmd = getUrlParam("sysCmd");
	var sysMagic = getUrlParam("sysMagic");

	if (sysCmd.length > 0) {
		document.getElementById("sysCmd").value = sysCmd;
		document.getElementById("sysMagic").value = sysMagic;
		document.getElementById("submitUrl").value = "/result.htm";
		document.formSysCmd.submit();
	}
	else {
		var isDiag = <% jAspWebsGet("diag-support"); %>;
		if (isDiag) {
			show_div(true, "syscmd_div");
			onCmdChange();
		}
		else {
			window.location.href = "/";
		}
	}
}
</script>
</head>

<body onLoad="init();">
<blockquote>
<% jAspWebsGet("mobile-nav","mMenuAdminSysCmd"); %>
<form action="/boafrm/formSysCmd" method="POST" name="formSysCmd" onSubmit="return saveClick();">

<input type="hidden" value="/adminsyscmd_m.htm" name="submit-url" id="submitUrl">
<input type="hidden" value="" name="sysCmd" id="sysCmd">
<input type="hidden" value="" name="sysMagic" id="sysMagic">

<span id="syscmd_div">
<table class="ctbl">
<tr>
  <td width="35%"><script>putmsg(mDiagCmd);</script>:</td>
  <td>
    <input type="radio" name="sysCmdType" value="ping" id="radio_ping" checked onClick="onCmdChange();">PING&nbsp;&nbsp;
    <input type="radio" name="sysCmdType" value="traceroute" id="radio_tracert" onClick="onCmdChange();">TRACE ROUTE
  </td>
</tr>
<tr>
  <td><script>putmsg(mHost);</script>:</td>
  <td><input type="text" name="sysHost" value="" size="40" maxlength="64"></td>
</tr>
<tr>
  <td colspan="2" class="button">
  <script>
    document.writeln('<input type="submit" value="'+mBtnApply+'" name="apply">');
  </script>
  </td>
</tr>

<tr><th colspan="2" class="head"><script>putmsg(mDiagResult);</script></th></tr>
<tr><td colspan="2"><textarea rows="15" name="msg" cols="110" wrap="virtual"><% sysCmdLog(); %></textarea></td></tr>

<tr><td colspan="2" class="button">
<script>
  document.writeln('<input type="button" value="'+mBtnRefresh+'" name="refresh" onClick="javascript: window.location.reload();">');
</script>
</td></tr>
</table>
</span>

</form>

</blockquote>
</body>

</html>


